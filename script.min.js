class PixelArtGenerator{constructor(){this.currentColor="#000000",this.currentAlpha=255,this.canvas=document.getElementById("pixelCanvas"),this.widthInput=document.getElementById("width"),this.heightInput=document.getElementById("height"),this.brushSizeInput=document.getElementById("brushSize"),this.brushSizeValue=document.getElementById("brushSizeValue"),this.generateBtn=document.getElementById("generate"),this.colorPicker=document.getElementById("colorPicker"),this.opacitySlider=document.getElementById("opacitySlider"),this.opacityValue=document.getElementById("opacityValue"),this.presetColors=document.querySelectorAll(".preset-color"),this.exportBtn=document.getElementById("exportBtn"),this.exportPngBtn=document.getElementById("exportPngBtn"),this.clearBtn=document.getElementById("clearBtn"),this.importFile=document.getElementById("importFile"),this.gridWidth=0,this.gridHeight=0,this.init()}init(){let t;this.generateBtn.addEventListener("click",(()=>this.generateGrid())),this.colorPicker.addEventListener("change",(t=>this.setCurrentColor(t.target.value))),this.opacitySlider&&this.opacityValue&&this.opacitySlider.addEventListener("input",(t=>{this.currentAlpha=parseInt(t.target.value),this.opacityValue.textContent=this.currentAlpha})),this.brushSizeInput&&this.brushSizeValue&&(this.brushSizeInput.addEventListener("input",(t=>{this.brushSizeValue.textContent=t.target.value})),this.brushSizeValue.textContent=this.brushSizeInput.value),this.presetColors.forEach((t=>{t.addEventListener("click",(()=>{const e=t.getAttribute("data-color");this.setCurrentColor(e),this.opacitySlider&&this.opacityValue&&(this.currentAlpha=255,this.opacitySlider.value=255,this.opacityValue.textContent=255)}))})),this.exportBtn.addEventListener("click",(()=>this.exportToCSV())),this.exportPngBtn.addEventListener("click",(()=>this.exportToPNG())),this.clearBtn.addEventListener("click",(()=>this.clearCanvas())),this.importFile.addEventListener("change",(t=>this.importFromCSV(t))),window.addEventListener("resize",(()=>{clearTimeout(t),t=setTimeout((()=>{this.resizeGrid()}),250)})),this.generateGrid(),this.setActivePreset(this.currentColor),this.opacitySlider&&this.opacityValue&&(this.opacitySlider.value=this.currentAlpha,this.opacityValue.textContent=this.currentAlpha)}generateGrid(){const t=parseInt(this.widthInput.value),e=parseInt(this.heightInput.value);if(t<1||e<1||t>50||e>50)return void alert("Please enter valid dimensions (1-50)");this.gridWidth=t,this.gridHeight=e,this.canvas.innerHTML="";const i=this.canvas.parentElement.clientWidth-40-1*(t-1)-4,r=this.canvas.parentElement.clientHeight-40-1*(e-1)-4,s=Math.floor(i/t),n=Math.floor(r/e);let a=Math.min(s,n);a=t>30||e>30?Math.max(a,4):Math.max(a,8);const h=a;this.canvas.style.gridTemplateColumns=`repeat(${t}, ${h}px)`,this.canvas.style.gridTemplateRows=`repeat(${e}, ${h}px)`;for(let i=0;i<t*e;i++){const t=document.createElement("div");t.className="pixel-bg",t.style.width=`${h}px`,t.style.height=`${h}px`;const e=document.createElement("div");e.className="pixel",e.style.width="100%",e.style.height="100%",e.dataset.index=i,e.style.backgroundColor="transparent",e.addEventListener("click",(()=>this.paintWithBrush(i))),e.addEventListener("mousedown",(()=>{this.isDrawing=!0,this.paintWithBrush(i)})),e.addEventListener("mouseenter",(()=>{this.isDrawing&&this.paintWithBrush(i)})),t.appendChild(e),this.canvas.appendChild(t)}document.addEventListener("mouseup",(()=>{this.isDrawing=!1}))}paintWithBrush(t){const e=parseInt(this.brushSizeInput.value),i=Math.floor(t/this.gridWidth),r=t%this.gridWidth,s=e-1;for(let t=i-s;t<=i+s;t++)for(let e=r-s;e<=r+s;e++)if(t>=0&&t<this.gridHeight&&e>=0&&e<this.gridWidth){const n=t-i,a=e-r;if(Math.sqrt(n*n+a*a)<=s+.5){const i=t*this.gridWidth+e,r=this.canvas.children[i];r&&this.paintPixel(r)}}}paintPixel(t){let e=this.currentColor,i=this.currentAlpha;if(e.startsWith("#")){let t=e.replace("#","");3===t.length&&(t=t.split("").map((t=>t+t)).join("")),6===t.length?t+=i.toString(16).padStart(2,"0"):8===t.length&&(t=t.slice(0,6)+i.toString(16).padStart(2,"0")),e="#"+t}else if(e.startsWith("rgb")){let t=e.match(/rgba?\((\d+),\s*(\d+),\s*(\d+)(?:,\s*([\d.]+))?\)/);if(t){e=`rgba(${parseInt(t[1])},${parseInt(t[2])},${parseInt(t[3])},${(i/255).toFixed(3)})`}}t.children[0].style.backgroundColor=e}setCurrentColor(t){this.currentColor=t,this.colorPicker.value=t,this.setActivePreset(t)}setActivePreset(t){this.presetColors.forEach((e=>{e.classList.remove("active"),e.getAttribute("data-color")===t&&e.classList.add("active")}))}savePixelColors(){const t=[];if(this.canvas.children.length>0)for(let e=0;e<this.canvas.children.length;e++){const i=this.canvas.children[e].children[0];t.push(i.style.backgroundColor||"white")}return t}restorePixelColors(t){if(t&&t.length===this.canvas.children.length)for(let e=0;e<this.canvas.children.length;e++){this.canvas.children[e].children[0].style.backgroundColor=t[e]}}resizeGrid(){if(0===this.gridWidth||0===this.gridHeight)return;const t=this.savePixelColors();this.regenerateGridLayout(),this.restorePixelColors(t)}regenerateGridLayout(){const t=this.gridWidth,e=this.gridHeight,i=this.canvas.parentElement.clientWidth-40-1*(t-1)-4,r=this.canvas.parentElement.clientHeight-40-1*(e-1)-4,s=Math.floor(i/t),n=Math.floor(r/e);let a=Math.min(s,n);a=t>30||e>30?Math.max(a,4):Math.max(a,8);const h=a;this.canvas.style.gridTemplateColumns=`repeat(${t}, ${h}px)`,this.canvas.style.gridTemplateRows=`repeat(${e}, ${h}px)`;for(let t=0;t<this.canvas.children.length;t++){const e=this.canvas.children[t];e.style.width=`${h}px`,e.style.height=`${h}px`}}rgbToHex(t){if(!t||"white"===t||""===t||"transparent"===t)return"#00000000";if(t.startsWith("#")){let e=t.replace("#","");if(3===e.length)e=e.split("").map((t=>t+t)).join("")+"ff";else if(4===e.length)e=e.split("").map((t=>t+t)).join("");else if(6===e.length)e+="ff";else if(8!==e.length)return"#00000000";return"#"+e.toLowerCase()}let e=t.match(/rgba?\((\d+),\s*(\d+),\s*(\d+)(?:,\s*([\d.]+))?\)/);if(e){const t=parseInt(e[1]),i=parseInt(e[2]),r=parseInt(e[3]);let s=255;return void 0!==e[4]&&(s=Math.round(255*parseFloat(e[4]))),"#"+[t,i,r,s].map(((t,e)=>(e<3?t:s).toString(16).padStart(2,"0"))).join("").toLowerCase()}return"#00000000"}compressHex(t){return 8===(t=t.replace("#","")).length&&"ff"===t.slice(6)&&(t=t.slice(0,6)),6===t.length?t[0]===t[1]&&t[2]===t[3]&&t[4]===t[5]?"#"+t[0]+t[2]+t[4]:"#"+t:8===t.length?t[0]===t[1]&&t[2]===t[3]&&t[4]===t[5]&&t[6]===t[7]?"#"+t[0]+t[2]+t[4]+t[6]:"#"+t:4===t.length||3===t.length?"#"+t:"#000"}exportToCSV(){if(0===this.gridWidth||0===this.gridHeight)return void alert("No grid to export!");const t=[];t.push(`# Pixel Art Export - ${this.gridWidth}x${this.gridHeight}`),t.push(`# Width: ${this.gridWidth}, Height: ${this.gridHeight}`);for(let e=0;e<this.gridHeight;e++){const i=[];for(let t=0;t<this.gridWidth;t++){const r=e*this.gridWidth+t,s=this.canvas.children[r].children[0],n=s?s.style.backgroundColor:"transparent",a=this.rgbToHex(n),h=this.compressHex(a);i.push(h)}t.push(i.join(","))}const e=t.join("\n"),i=new Blob([e],{type:"text/csv"}),r=window.URL.createObjectURL(i),s=document.createElement("a");s.href=r,s.download=`pixel-art-${this.gridWidth}x${this.gridHeight}-${(new Date).toISOString().slice(0,10)}.csv`,document.body.appendChild(s),s.click(),document.body.removeChild(s),window.URL.revokeObjectURL(r)}importFromCSV(t){const e=t.target.files[0];if(!e)return;const i=new FileReader;i.onload=t=>{try{const e=t.target.result,i=e.split(/\r?\n|\r/).map((t=>t.trim())).filter((t=>t&&!t.startsWith("# ")));if(0===i.length)return void alert("No valid data found in CSV file!");const r=i.length,s=i[0].split(",").length,n=/^#([0-9A-Fa-f]{3}|[0-9A-Fa-f]{4}|[0-9A-Fa-f]{6}|[0-9A-Fa-f]{8})$/;for(let t of i){const e=t.split(",");for(let t of e)if(!n.test(t.trim()))return void alert(`Invalid hex color found: ${t.trim()}`)}this.widthInput.value=s,this.heightInput.value=r,this.generateGrid();for(let t=0;t<r;t++){const e=i[t].split(",");for(let i=0;i<s;i++){const r=t*s+i,n=this.canvas.children[r].children[0];n&&e[i]&&(n.style.backgroundColor=e[i].trim())}}setTimeout((()=>{alert(`Successfully imported ${s}x${r} pixel art!`)}),100)}catch(t){alert("Error reading CSV file: "+t.message)}},i.readAsText(e),t.target.value=""}clearCanvas(){if(confirm("Are you sure you want to clear all pixels? This cannot be undone."))for(let t=0;t<this.canvas.children.length;t++){this.canvas.children[t].children[0].style.backgroundColor="transparent"}}fillCanvas(){for(let t=0;t<this.canvas.children.length;t++){this.canvas.children[t].children[0].style.backgroundColor=this.currentColor}}exportToPNG(){if(0===this.gridWidth||0===this.gridHeight)return void alert("No grid to export!");const t=document.createElement("canvas"),e=t.getContext("2d"),i=10;t.width=this.gridWidth*i,t.height=this.gridHeight*i;for(let t=0;t<this.gridHeight;t++)for(let r=0;r<this.gridWidth;r++){const s=t*this.gridWidth+r,n=this.canvas.children[s].children[0],a=n?n.style.backgroundColor:"transparent";let h=this.rgbToHex(a),l=this.hexToRgba(h);e.fillStyle=l,e.fillRect(r*i,t*i,i,i)}t.toBlob((t=>{const e=URL.createObjectURL(t),i=document.createElement("a");i.href=e,i.download=`pixel-art-${this.gridWidth}x${this.gridHeight}-${(new Date).toISOString().slice(0,10)}.png`,document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(e)}),"image/png")}hexToRgba(t){3===(t=t.replace("#","")).length?t=t[0]+t[0]+t[1]+t[1]+t[2]+t[2]+"ff":4===t.length?t=t[0]+t[0]+t[1]+t[1]+t[2]+t[2]+t[3]+t[3]:6===t.length&&(t+="ff");return`rgba(${parseInt(t.slice(0,2),16)},${parseInt(t.slice(2,4),16)},${parseInt(t.slice(4,6),16)},${parseInt(t.slice(6,8),16)/255})`}}document.addEventListener("DOMContentLoaded",(()=>{const t=new PixelArtGenerator;document.getElementById("fillBtn").addEventListener("click",(()=>t.fillCanvas()))}));